{"version":3,"sources":["fluid.js"],"names":["clamp","a","min","max","Math","lerp","c","b","sampler","width","height","stride","offset","f","x","y","value","undefined","random","n","floor","Fluider","canvas","step","color","WIDTH","HEIGHT","ctx","getContext","animate","bind","sx","clientWidth","sy","clientHeight","mouseX","mouseY","rect","getBoundingClientRect","left","top","window","addEventListener","e","clientX","clientY","lastMouseX","lastMouseY","pointX","pointY","prevPointX","prevPointY","fillRect","imageData","getImageData","velocityField0","Float32Array","u0x","u0y","velocityField1","u1x","u1y","pressureField0","p0","pressureField1","p1","divergenceField","div","i","length","velocityBoundary","advect","addMouseForce","computeDivergence","fastjacobi","subtractPressureGradient","aux","ux","uy","dx","dy","src","dest","vx","vy","bilerp","sample","x0","y0","x1","y1","p00","p01","p10","p11","alpha","beta","iterations","pi","p","data","putImageData","simulate","draw","requestAnimationFrame","fluider","document","getElementById","run"],"mappings":"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","file":"fluid.1aa6e9f9.map","sourceRoot":"../src","sourcesContent":["function clamp(a, min, max){\n  return Math.max(Math.min(a, max), min);\n}\n\nfunction lerp(c, a, b){\n  c = c < 0 ? 0 : (c > 1 ? 1 : c);\n\n  return a * (1 - c) + b * c;\n}\n\nfunction sampler(a, width, height, stride, offset){\n  var f = function(x, y, value) {\n      x = (x < 0 ? 0 : (x > width-1 ? width-1 : x))|0;\n      y = (y < 0 ? 0 : (y > height-1 ? height-1 : y))|0;\n      if(value !== undefined){\n          a[(x+y*width)*stride+offset] = value;\n      }\n      else {\n          return a[(x+y*width)*stride+offset];\n      }\n  };\n  f.a = a;\n  return f;\n}\n\nfunction random(n) {\n  return Math.floor(Math.random() * n);\n}\n\n\nclass Fluider {\n  constructor(canvas, {\n    step = 4.0,\n    color = 555,\n  } = {}) {\n    this.canvas = canvas;\n    this.WIDTH = canvas.width;\n    this.HEIGHT = canvas.height;\n    this.ctx = canvas.getContext('2d');\n    \n    this.step = step;\n    this.color = color;\n\n    this.animate = this.animate.bind(this);\n  }\n\n  run() {\n    this.sx = this.canvas.width/ this.canvas.clientWidth;\n    this.sy = this.canvas.height/ this.canvas.clientHeight;\n    this.mouseX = 0;\n    this.mouseY = 0;\n    const rect = this.canvas.getBoundingClientRect();\n    this.left = rect.left\n    this.top = rect.top;\n\n    window.addEventListener('mousemove', (e) => {\n        this.mouseX = (e.clientX - this.left)|0,\n        this.mouseY = (e.clientY - this.top)|0;\n    }); \n\n    this.lastMouseX = this.mouseX;\n    this.lastMouseY = this.mouseY;\n\n\n    // \n    this.pointX = 100;\n    this.pointY = 100;\n    this.prevPointX = this.pointX;\n    this.prevPointY = this.pointY;\n\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n\n    this.ctx.fillRect(0, 0, WIDTH, HEIGHT);\n    this.imageData = this.ctx.getImageData(0, 0, WIDTH, HEIGHT);\n\n    this.velocityField0 = new Float32Array(WIDTH*HEIGHT*2);\n    this.u0x = sampler(this.velocityField0, WIDTH, HEIGHT, 2, 0);\n    this.u0y = sampler(this.velocityField0, WIDTH, HEIGHT, 2, 1);\n    this.velocityField1 = new Float32Array(WIDTH*HEIGHT*2);\n    this.u1x = sampler(this.velocityField1, WIDTH, HEIGHT, 2, 0);\n    this.u1y = sampler(this.velocityField1, WIDTH, HEIGHT, 2, 1);\n    this.pressureField0 = new Float32Array(WIDTH*HEIGHT);\n    this.p0 = sampler(this.pressureField0, WIDTH, HEIGHT, 1, 0);\n    this.pressureField1 = new Float32Array(WIDTH*HEIGHT);\n    this.p1 = sampler(this.pressureField1, WIDTH, HEIGHT, 1, 0);\n    this.divergenceField = new Float32Array(WIDTH*HEIGHT);\n    this.div = sampler(this.divergenceField, WIDTH, HEIGHT, 1, 0);\n\n    for(let i = 0; i < this.pressureField0.length; i++) {\n      this.pressureField0[i] = 0;\n      this.pressureField1[i] = this.pressureField0[i];\n    }\n\n    for(let i = 0; i < this.velocityField0.length; i++) {\n      this.velocityField1[i] = this.velocityField0[i];\n    }\n\n    this.velocityBoundary();\n\n    this.animate();\n    // setInterval(() => {\n    //   this.move(this.pointX - 10 + random(20), this.pointX - 10 + random(20));\n    // }, 100)\n  }\n\n  simulate() {\n    this.velocityBoundary();\n    this.advect(this.u0x, this.u1x);\n    this.advect(this.u0y, this.u1y);\n    this.addMouseForce();\n    // this.move(this.pointX - 1 + random(3), this.pointY - 1 + random(3))\n    // this.addPoint();\n    this.computeDivergence();\n    this.fastjacobi(this.p0, this.p1, this.div, -1, 0.25, 16);\n    this.subtractPressureGradient();\n\n    let aux = this.p0;\n    this.p0 = this.p1;\n    this.p1 = aux;\n  \n    aux = this.u0x;\n    this.u0x = this.u1x;\n    this.u1x = aux;\n  \n    aux = this.u0y;\n    this.u0y = this.u1y;\n    this.u1y = aux;\n  }\n\n  move(x, y) {\n    this.pointX = x;\n    this.pointY = y;\n  }\n\n  addPoint() {\n    const ux = this.u1x;\n    const uy = this.u1y;\n\n    const x = clamp(this.pointX, 10, this.WIDTH - 11);\n    const y = clamp(this.pointY, 10, this.HEIGHT - 11);\n\n    const dx = this.pointX - this.prevPointX;\n    const dy = this.pointY - this.prevPointY;\n\n    this.prevPointX = this.pointX;\n    this.prevPointY = this.pointX;\n\n    ux(x, y, ux(x, y)-dx);\n    uy(x, y, uy(x, y)-dy);\n  }\n\n  addMouseForce() {\n    const ux = this.u1x;\n    const uy = this.u1y;\n\n    const x = clamp(this.mouseX * this.sx, 1, this.WIDTH - 2);\n    const y = clamp(this.mouseY * this.sy, 1, this.HEIGHT - 2);\n\n    // console.log(x, y);\n    const dx = this.mouseX - this.lastMouseX;\n    const dy = this.mouseY - this.lastMouseY;\n\n    // console.log(dx, dy);\n    this.lastMouseX = this.mouseX;\n    this.lastMouseY = this.mouseY;\n\n\n    ux(x, y, ux(x, y)-dx);\n    uy(x, y, uy(x, y)-dy);\n  }\n\n  velocityBoundary() {\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n\n    const ux = this.u0x;\n    const uy = this.u0y;\n\n    for(let x = 0; x < WIDTH; x++) {\n      ux(x, 0, -ux(x, 1));\n      uy(x, 0, -uy(x, 1));\n\n      ux(x, HEIGHT-1, -ux(x, HEIGHT-2));\n      uy(x, HEIGHT-1, -uy(x, HEIGHT-2));\n    }\n\n    for(let y = 0; y < HEIGHT; y++) {\n      ux(0, y, -ux(1, y));\n      uy(0, y, -uy(1, y));\n\n      ux(WIDTH-1, y, -ux(WIDTH-2, y));\n      uy(WIDTH-1, y, -uy(WIDTH-2, y));\n    }\n  }\n\n  advect(src, dest) {\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n    const ux = this.u0x;\n    const uy = this.u0y;\n    const step = this.step;\n\n    for(let y = 1; y < HEIGHT-1; y++) {\n      for(let x = 1; x < WIDTH-1; x++) {\n        const vx = ux(x, y)*step;\n        const vy = uy(x, y)*step;\n  \n        dest(x, y, this.bilerp(src, x+vx, y+vy));\n      }\n    }\n  }\n\n  bilerp(sample, x, y) {\n    const x0 = ~~x;\n    const y0 = ~~y;\n    const x1 = x0+1;\n    const y1 = y0+1;\n    const p00 = sample(x0, y0);\n    const p01 = sample(x0, y1);\n    const p10 = sample(x1, y0);\n    const p11 = sample(x1, y1);\n\n    return lerp(y-y0, lerp(x-x0, p00, p10), lerp(x-x0, p01, p11));\n  }\n\n  computeDivergence() {\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n    const ux = this.u1x;\n    const uy = this.u1y;\n    const div = this.div;\n\n    for(let y = 1; y < HEIGHT-1; y++) {\n      for(let x = 1; x < WIDTH-1; x++) {\n        // compute divergence using central difference\n        const x0 = ux(x-1, y);\n        const x1 = ux(x+1, y);\n        const y0 = uy(x, y-1);\n        const y1 = uy(x, y+1);\n        div(x, y, (x1 - x0 + y1 - y0) * 0.5);\n      }\n    }\n  }\n\n  fastjacobi(p0, p1, b, alpha, beta, iterations){\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n    p0 = p0.a;\n    p1 = p1.a;\n    b = b.a;\n    //for(var i = 0; i < pressureField0.length; i++) {\n        //pressureField0[i] = 0.5;\n        //pressureField1[i] = pressureField0[i];\n    //}\n\n    for(let i = 0; i < iterations; i++) {\n      for(let y = 1; y < HEIGHT-1; y++) {\n        for(let x = 1; x < WIDTH-1; x++) {\n          let pi = x+y*WIDTH;\n          let x0 = p0[pi-1];\n          let x1 = p0[pi+1];\n          let y0 = p0[pi-WIDTH];\n          let y1 = p0[pi+WIDTH];\n\n          p1[pi] = (x0 + x1 + y0 + y1 + alpha * b[pi]) * beta;\n        }\n      }\n      var aux = p0;\n      p0 = p1;\n      p1 = aux;\n      //pressureboundary(p0);\n    }\n  }\n\n  subtractPressureGradient() {\n    const ux = this.u1x;\n    const uy = this.u1y;\n    const p = this.p0;\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n\n    for(var y = 1; y < HEIGHT-1; y++) {\n      for(var x = 1; x < WIDTH-1; x++) {\n        let x0 = p(x-1, y);\n        let x1 = p(x+1, y);\n        let y0 = p(x, y-1);\n        let y1 = p(x, y+1);\n        let dx = (x1-x0)/2;\n        let dy = (y1-y0)/2;\n\n        ux(x, y, ux(x, y)-dx);\n        uy(x, y, uy(x, y)-dy);\n      }\n    }\n  }\n\n  draw() {\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n    const data = this.imageData.data;\n    const p = this.p0;\n    const ux = this.u0x;\n    const uy = this.u0y;\n\n    for (let y = 0; y < HEIGHT; y++) {\n      for (let x = 0; x < WIDTH; x++) {\n        const offset = (y * WIDTH + x) * 4;\n\n        // if (x > 18 && x < 20 && y > 18 && y < 20) {\n\n        //   console.log(p(x, y))\n        // }\n        data[offset + 0] = p(x, y) * this.color;\n        data[offset + 1] = ux(x, y) * 128 + 128;\n        data[offset + 2] = uy(x, y) * 128 + 128;\n        // data[offset + 3] = 0;\n        data[offset + 1] = 0;\n        data[offset + 2] = 0;\n      }\n    }\n\n    this.ctx.putImageData(this.imageData, 0, 0);\n  }\n\n  animate() {\n    this.simulate();\n    this.draw();\n\n    window.requestAnimationFrame(this.animate);\n  }\n}\n\nconst fluider = new Fluider(document.getElementById('canvas'));\nfluider.run();\n// const fluider2 = new Fluider(\n//   document.getElementById('canvas2'), \n//   { \n//     step: 8,\n//   }\n// )\n// fluider2.run();"]}