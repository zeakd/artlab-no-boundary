{"version":3,"sources":["utils.js","fluid.js","main.js"],"names":["random","n","Math","floor","lerp","c","a","b","hexToRgb","hex","result","exec","r","parseInt","g","clamp","min","max","sampler","width","height","stride","offset","f","x","y","value","undefined","Fluider","canvas","step","color","WIDTH","HEIGHT","ctx","getContext","animate","bind","setColor","colorMapper","p","ux","uy","rate","srcColor","destColor","func","sx","clientWidth","sy","clientHeight","mouseX","mouseY","rect","getBoundingClientRect","left","top","window","addEventListener","e","clientX","clientY","lastMouseX","lastMouseY","pointX","pointY","prevPointX","prevPointY","fillRect","imageData","getImageData","velocityField0","Float32Array","u0x","u0y","velocityField1","u1x","u1y","pressureField0","p0","pressureField1","p1","divergenceField","div","i","length","velocityBoundary","advect","addMouseForce","computeDivergence","fastjacobi","subtractPressureGradient","aux","dx","dy","src","dest","vx","vy","bilerp","sample","x0","y0","x1","y1","p00","p01","p10","p11","alpha","beta","iterations","pi","data","putImageData","simulate","draw","requestAnimationFrame","colors","fluider","document","getElementById","run","currentColors","age","aged","map","originColor","prevRate","filter","setInterval","mapper","createColorMapper","setColorMapper","pop","push","getGradientedColor","_rate","bigColor","biggestColor","reduce","small","big","ratio","isNaN","console","log","Error"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAO,SAASA,MAAT,CAAgBC,CAAhB,EAAmB;AACxB,SAAOC,IAAI,CAACC,KAAL,CAAWD,IAAI,CAACF,MAAL,KAAgBC,CAA3B,CAAP;AACD;;AAEM,SAASG,IAAT,CAAcC,CAAd,EAAiBC,CAAjB,EAAoBC,CAApB,EAAsB;AAC3BF,EAAAA,CAAC,GAAGA,CAAC,GAAG,CAAJ,GAAQ,CAAR,GAAaA,CAAC,GAAG,CAAJ,GAAQ,CAAR,GAAYA,CAA7B;AAEA,SAAOC,CAAC,IAAI,IAAID,CAAR,CAAD,GAAcE,CAAC,GAAGF,CAAzB;AACD;;AAEM,SAASG,QAAT,CAAkBC,GAAlB,EAAuB;AAC5B,MAAIC,MAAM,GAAG,4CAA4CC,IAA5C,CAAiDF,GAAjD,CAAb;AACA,SAAOC,MAAM,GAAG;AACZE,IAAAA,CAAC,EAAEC,QAAQ,CAACH,MAAM,CAAC,CAAD,CAAP,EAAY,EAAZ,CADC;AAEZI,IAAAA,CAAC,EAAED,QAAQ,CAACH,MAAM,CAAC,CAAD,CAAP,EAAY,EAAZ,CAFC;AAGZH,IAAAA,CAAC,EAAEM,QAAQ,CAACH,MAAM,CAAC,CAAD,CAAP,EAAY,EAAZ;AAHC,GAAH,GAIT,IAJJ;AAKD;;AAEM,SAASK,KAAT,CAAeT,CAAf,EAAkBU,GAAlB,EAAuBC,GAAvB,EAA2B;AAChC,SAAOf,IAAI,CAACe,GAAL,CAASf,IAAI,CAACc,GAAL,CAASV,CAAT,EAAYW,GAAZ,CAAT,EAA2BD,GAA3B,CAAP;AACD;;;;;;;;;ACrBD;;;;;;;;AAEA,SAASE,OAAT,CAAiBZ,CAAjB,EAAoBa,KAApB,EAA2BC,MAA3B,EAAmCC,MAAnC,EAA2CC,MAA3C,EAAkD;AAChD,MAAIC,CAAC,GAAG,SAAJA,CAAI,CAASC,CAAT,EAAYC,CAAZ,EAAeC,KAAf,EAAsB;AAC1BF,IAAAA,CAAC,GAAG,CAACA,CAAC,GAAG,CAAJ,GAAQ,CAAR,GAAaA,CAAC,GAAGL,KAAK,GAAC,CAAV,GAAcA,KAAK,GAAC,CAApB,GAAwBK,CAAtC,IAA0C,CAA9C;AACAC,IAAAA,CAAC,GAAG,CAACA,CAAC,GAAG,CAAJ,GAAQ,CAAR,GAAaA,CAAC,GAAGL,MAAM,GAAC,CAAX,GAAeA,MAAM,GAAC,CAAtB,GAA0BK,CAAxC,IAA4C,CAAhD;;AACA,QAAGC,KAAK,KAAKC,SAAb,EAAuB;AACnBrB,MAAAA,CAAC,CAAC,CAACkB,CAAC,GAACC,CAAC,GAACN,KAAL,IAAYE,MAAZ,GAAmBC,MAApB,CAAD,GAA+BI,KAA/B;AACH,KAFD,MAGK;AACD,aAAOpB,CAAC,CAAC,CAACkB,CAAC,GAACC,CAAC,GAACN,KAAL,IAAYE,MAAZ,GAAmBC,MAApB,CAAR;AACH;AACJ,GATD;;AAUAC,EAAAA,CAAC,CAACjB,CAAF,GAAMA,CAAN;AACA,SAAOiB,CAAP;AACD;;IAEKK;;;AACJ,mBAAYC,MAAZ,EAGQ;AAAA,mFAAJ,EAAI;AAAA,yBAFNC,IAEM;AAAA,QAFNA,IAEM,0BAFC,GAED;AAAA,0BADNC,KACM;AAAA,QADNA,KACM,2BADE,SACF;;AAAA;;AACN,SAAKF,MAAL,GAAcA,MAAd;AACA,SAAKG,KAAL,GAAaH,MAAM,CAACV,KAApB;AACA,SAAKc,MAAL,GAAcJ,MAAM,CAACT,MAArB;AACA,SAAKc,GAAL,GAAWL,MAAM,CAACM,UAAP,CAAkB,IAAlB,CAAX;AAEA,SAAKL,IAAL,GAAYA,IAAZ;AACA,SAAKC,KAAL,GAAaA,KAAb;AAEA,SAAKK,OAAL,GAAe,KAAKA,OAAL,CAAaC,IAAb,CAAkB,IAAlB,CAAf;AACA,SAAKC,QAAL,GAAgB,KAAKA,QAAL,CAAcD,IAAd,CAAmB,IAAnB,CAAhB;;AACA,SAAKE,WAAL,GAAmB,UAACC,CAAD,EAAIC,EAAJ,EAAQC,EAAR,EAAe;AAEhC,UAAMC,IAAI,GAAGH,CAAC,GAAG,GAAJ,GAAU,GAAvB;AACA,UAAMI,QAAQ,GAAG,qBAAS,SAAT,CAAjB;AACA,UAAMC,SAAS,GAAG,qBAAS,SAAT,CAAlB;AACA,aAAO;AACLjC,QAAAA,CAAC,EAAE,iBAAK+B,IAAL,EAAWC,QAAQ,CAAChC,CAApB,EAAuBiC,SAAS,CAACjC,CAAjC,CADE;AAELE,QAAAA,CAAC,EAAE,iBAAK6B,IAAL,EAAWC,QAAQ,CAAC9B,CAApB,EAAuB+B,SAAS,CAAC/B,CAAjC,CAFE;AAGLP,QAAAA,CAAC,EAAE,iBAAKoC,IAAL,EAAWC,QAAQ,CAACrC,CAApB,EAAuBsC,SAAS,CAACtC,CAAjC;AAHE,OAAP;AAMD,KAXD;AAYD;;;;6BAEQwB,OAAO;AACd,WAAKA,KAAL,GAAa,qBAASA,KAAT,KAAmB,qBAAS,SAAT,CAAhC;AACD;;;mCAEce,MAAM;AACnB,WAAKP,WAAL,GAAmBO,IAAnB;AACD;;;0BAEK;AAAA;;AACJ,WAAKR,QAAL,CAAc,KAAKP,KAAnB;AAEA,WAAKgB,EAAL,GAAU,KAAKlB,MAAL,CAAYV,KAAZ,GAAmB,KAAKU,MAAL,CAAYmB,WAAzC;AACA,WAAKC,EAAL,GAAU,KAAKpB,MAAL,CAAYT,MAAZ,GAAoB,KAAKS,MAAL,CAAYqB,YAA1C;AACA,WAAKC,MAAL,GAAc,CAAd;AACA,WAAKC,MAAL,GAAc,CAAd;AACA,UAAMC,IAAI,GAAG,KAAKxB,MAAL,CAAYyB,qBAAZ,EAAb;AACA,WAAKC,IAAL,GAAYF,IAAI,CAACE,IAAjB;AACA,WAAKC,GAAL,GAAWH,IAAI,CAACG,GAAhB;AAEAC,MAAAA,MAAM,CAACC,gBAAP,CAAwB,WAAxB,EAAqC,UAACC,CAAD,EAAO;AACxC,QAAA,KAAI,CAACR,MAAL,GAAeQ,CAAC,CAACC,OAAF,GAAY,KAAI,CAACL,IAAlB,GAAwB,CAAtC,EACA,KAAI,CAACH,MAAL,GAAeO,CAAC,CAACE,OAAF,GAAY,KAAI,CAACL,GAAlB,GAAuB,CADrC;AAEH,OAHD;AAKA,WAAKM,UAAL,GAAkB,KAAKX,MAAvB;AACA,WAAKY,UAAL,GAAkB,KAAKX,MAAvB,CAjBI,CAoBJ;;AACA,WAAKY,MAAL,GAAc,GAAd;AACA,WAAKC,MAAL,GAAc,GAAd;AACA,WAAKC,UAAL,GAAkB,KAAKF,MAAvB;AACA,WAAKG,UAAL,GAAkB,KAAKF,MAAvB;AAEA,UAAMjC,KAAK,GAAG,KAAKA,KAAnB;AACA,UAAMC,MAAM,GAAG,KAAKA,MAApB;AAEA,WAAKC,GAAL,CAASkC,QAAT,CAAkB,CAAlB,EAAqB,CAArB,EAAwBpC,KAAxB,EAA+BC,MAA/B;AACA,WAAKoC,SAAL,GAAiB,KAAKnC,GAAL,CAASoC,YAAT,CAAsB,CAAtB,EAAyB,CAAzB,EAA4BtC,KAA5B,EAAmCC,MAAnC,CAAjB;AAEA,WAAKsC,cAAL,GAAsB,IAAIC,YAAJ,CAAiBxC,KAAK,GAACC,MAAN,GAAa,CAA9B,CAAtB;AACA,WAAKwC,GAAL,GAAWvD,OAAO,CAAC,KAAKqD,cAAN,EAAsBvC,KAAtB,EAA6BC,MAA7B,EAAqC,CAArC,EAAwC,CAAxC,CAAlB;AACA,WAAKyC,GAAL,GAAWxD,OAAO,CAAC,KAAKqD,cAAN,EAAsBvC,KAAtB,EAA6BC,MAA7B,EAAqC,CAArC,EAAwC,CAAxC,CAAlB;AACA,WAAK0C,cAAL,GAAsB,IAAIH,YAAJ,CAAiBxC,KAAK,GAACC,MAAN,GAAa,CAA9B,CAAtB;AACA,WAAK2C,GAAL,GAAW1D,OAAO,CAAC,KAAKyD,cAAN,EAAsB3C,KAAtB,EAA6BC,MAA7B,EAAqC,CAArC,EAAwC,CAAxC,CAAlB;AACA,WAAK4C,GAAL,GAAW3D,OAAO,CAAC,KAAKyD,cAAN,EAAsB3C,KAAtB,EAA6BC,MAA7B,EAAqC,CAArC,EAAwC,CAAxC,CAAlB;AACA,WAAK6C,cAAL,GAAsB,IAAIN,YAAJ,CAAiBxC,KAAK,GAACC,MAAvB,CAAtB;AACA,WAAK8C,EAAL,GAAU7D,OAAO,CAAC,KAAK4D,cAAN,EAAsB9C,KAAtB,EAA6BC,MAA7B,EAAqC,CAArC,EAAwC,CAAxC,CAAjB;AACA,WAAK+C,cAAL,GAAsB,IAAIR,YAAJ,CAAiBxC,KAAK,GAACC,MAAvB,CAAtB;AACA,WAAKgD,EAAL,GAAU/D,OAAO,CAAC,KAAK8D,cAAN,EAAsBhD,KAAtB,EAA6BC,MAA7B,EAAqC,CAArC,EAAwC,CAAxC,CAAjB;AACA,WAAKiD,eAAL,GAAuB,IAAIV,YAAJ,CAAiBxC,KAAK,GAACC,MAAvB,CAAvB;AACA,WAAKkD,GAAL,GAAWjE,OAAO,CAAC,KAAKgE,eAAN,EAAuBlD,KAAvB,EAA8BC,MAA9B,EAAsC,CAAtC,EAAyC,CAAzC,CAAlB;;AAEA,WAAI,IAAImD,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG,KAAKN,cAAL,CAAoBO,MAAvC,EAA+CD,CAAC,EAAhD,EAAoD;AAClD,aAAKN,cAAL,CAAoBM,CAApB,IAAyB,CAAzB;AACA,aAAKJ,cAAL,CAAoBI,CAApB,IAAyB,KAAKN,cAAL,CAAoBM,CAApB,CAAzB;AACD;;AAED,WAAI,IAAIA,EAAC,GAAG,CAAZ,EAAeA,EAAC,GAAG,KAAKb,cAAL,CAAoBc,MAAvC,EAA+CD,EAAC,EAAhD,EAAoD;AAClD,aAAKT,cAAL,CAAoBS,EAApB,IAAyB,KAAKb,cAAL,CAAoBa,EAApB,CAAzB;AACD;;AAED,WAAKE,gBAAL;AAEA,WAAKlD,OAAL,GAxDI,CAyDJ;AACA;AACA;AACD;;;+BAEU;AACT,WAAKkD,gBAAL;AACA,WAAKC,MAAL,CAAY,KAAKd,GAAjB,EAAsB,KAAKG,GAA3B;AACA,WAAKW,MAAL,CAAY,KAAKb,GAAjB,EAAsB,KAAKG,GAA3B;AACA,WAAKW,aAAL,GAJS,CAKT;AACA;;AACA,WAAKC,iBAAL;AACA,WAAKC,UAAL,CAAgB,KAAKX,EAArB,EAAyB,KAAKE,EAA9B,EAAkC,KAAKE,GAAvC,EAA4C,CAAC,CAA7C,EAAgD,IAAhD,EAAsD,EAAtD;AACA,WAAKQ,wBAAL;AAEA,UAAIC,GAAG,GAAG,KAAKb,EAAf;AACA,WAAKA,EAAL,GAAU,KAAKE,EAAf;AACA,WAAKA,EAAL,GAAUW,GAAV;AAEAA,MAAAA,GAAG,GAAG,KAAKnB,GAAX;AACA,WAAKA,GAAL,GAAW,KAAKG,GAAhB;AACA,WAAKA,GAAL,GAAWgB,GAAX;AAEAA,MAAAA,GAAG,GAAG,KAAKlB,GAAX;AACA,WAAKA,GAAL,GAAW,KAAKG,GAAhB;AACA,WAAKA,GAAL,GAAWe,GAAX;AACD;;;yBAEIpE,GAAGC,GAAG;AACT,WAAKuC,MAAL,GAAcxC,CAAd;AACA,WAAKyC,MAAL,GAAcxC,CAAd;AACD;;;+BAEU;AACT,UAAMgB,EAAE,GAAG,KAAKmC,GAAhB;AACA,UAAMlC,EAAE,GAAG,KAAKmC,GAAhB;AAEA,UAAMrD,CAAC,GAAG,kBAAM,KAAKwC,MAAX,EAAmB,EAAnB,EAAuB,KAAKhC,KAAL,GAAa,EAApC,CAAV;AACA,UAAMP,CAAC,GAAG,kBAAM,KAAKwC,MAAX,EAAmB,EAAnB,EAAuB,KAAKhC,MAAL,GAAc,EAArC,CAAV;AAEA,UAAM4D,EAAE,GAAG,KAAK7B,MAAL,GAAc,KAAKE,UAA9B;AACA,UAAM4B,EAAE,GAAG,KAAK7B,MAAL,GAAc,KAAKE,UAA9B;AAEA,WAAKD,UAAL,GAAkB,KAAKF,MAAvB;AACA,WAAKG,UAAL,GAAkB,KAAKH,MAAvB;AAEAvB,MAAAA,EAAE,CAACjB,CAAD,EAAIC,CAAJ,EAAOgB,EAAE,CAACjB,CAAD,EAAIC,CAAJ,CAAF,GAASoE,EAAhB,CAAF;AACAnD,MAAAA,EAAE,CAAClB,CAAD,EAAIC,CAAJ,EAAOiB,EAAE,CAAClB,CAAD,EAAIC,CAAJ,CAAF,GAASqE,EAAhB,CAAF;AACD;;;oCAEe;AACd,UAAMrD,EAAE,GAAG,KAAKmC,GAAhB;AACA,UAAMlC,EAAE,GAAG,KAAKmC,GAAhB;AAEA,UAAMrD,CAAC,GAAG,kBAAM,KAAK2B,MAAL,GAAc,KAAKJ,EAAzB,EAA6B,CAA7B,EAAgC,KAAKf,KAAL,GAAa,CAA7C,CAAV;AACA,UAAMP,CAAC,GAAG,kBAAM,KAAK2B,MAAL,GAAc,KAAKH,EAAzB,EAA6B,CAA7B,EAAgC,KAAKhB,MAAL,GAAc,CAA9C,CAAV,CALc,CAOd;;AACA,UAAM4D,EAAE,GAAG,KAAK1C,MAAL,GAAc,KAAKW,UAA9B;AACA,UAAMgC,EAAE,GAAG,KAAK1C,MAAL,GAAc,KAAKW,UAA9B,CATc,CAWd;;AACA,WAAKD,UAAL,GAAkB,KAAKX,MAAvB;AACA,WAAKY,UAAL,GAAkB,KAAKX,MAAvB;AAGAX,MAAAA,EAAE,CAACjB,CAAD,EAAIC,CAAJ,EAAOgB,EAAE,CAACjB,CAAD,EAAIC,CAAJ,CAAF,GAASoE,EAAhB,CAAF;AACAnD,MAAAA,EAAE,CAAClB,CAAD,EAAIC,CAAJ,EAAOiB,EAAE,CAAClB,CAAD,EAAIC,CAAJ,CAAF,GAASqE,EAAhB,CAAF;AACD;;;uCAEkB;AACjB,UAAM9D,KAAK,GAAG,KAAKA,KAAnB;AACA,UAAMC,MAAM,GAAG,KAAKA,MAApB;AAEA,UAAMQ,EAAE,GAAG,KAAKgC,GAAhB;AACA,UAAM/B,EAAE,GAAG,KAAKgC,GAAhB;;AAEA,WAAI,IAAIlD,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGQ,KAAnB,EAA0BR,CAAC,EAA3B,EAA+B;AAC7BiB,QAAAA,EAAE,CAACjB,CAAD,EAAI,CAAJ,EAAO,CAACiB,EAAE,CAACjB,CAAD,EAAI,CAAJ,CAAV,CAAF;AACAkB,QAAAA,EAAE,CAAClB,CAAD,EAAI,CAAJ,EAAO,CAACkB,EAAE,CAAClB,CAAD,EAAI,CAAJ,CAAV,CAAF;AAEAiB,QAAAA,EAAE,CAACjB,CAAD,EAAIS,MAAM,GAAC,CAAX,EAAc,CAACQ,EAAE,CAACjB,CAAD,EAAIS,MAAM,GAAC,CAAX,CAAjB,CAAF;AACAS,QAAAA,EAAE,CAAClB,CAAD,EAAIS,MAAM,GAAC,CAAX,EAAc,CAACS,EAAE,CAAClB,CAAD,EAAIS,MAAM,GAAC,CAAX,CAAjB,CAAF;AACD;;AAED,WAAI,IAAIR,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGQ,MAAnB,EAA2BR,CAAC,EAA5B,EAAgC;AAC9BgB,QAAAA,EAAE,CAAC,CAAD,EAAIhB,CAAJ,EAAO,CAACgB,EAAE,CAAC,CAAD,EAAIhB,CAAJ,CAAV,CAAF;AACAiB,QAAAA,EAAE,CAAC,CAAD,EAAIjB,CAAJ,EAAO,CAACiB,EAAE,CAAC,CAAD,EAAIjB,CAAJ,CAAV,CAAF;AAEAgB,QAAAA,EAAE,CAACT,KAAK,GAAC,CAAP,EAAUP,CAAV,EAAa,CAACgB,EAAE,CAACT,KAAK,GAAC,CAAP,EAAUP,CAAV,CAAhB,CAAF;AACAiB,QAAAA,EAAE,CAACV,KAAK,GAAC,CAAP,EAAUP,CAAV,EAAa,CAACiB,EAAE,CAACV,KAAK,GAAC,CAAP,EAAUP,CAAV,CAAhB,CAAF;AACD;AACF;;;2BAEMsE,KAAKC,MAAM;AAChB,UAAMhE,KAAK,GAAG,KAAKA,KAAnB;AACA,UAAMC,MAAM,GAAG,KAAKA,MAApB;AACA,UAAMQ,EAAE,GAAG,KAAKgC,GAAhB;AACA,UAAM/B,EAAE,GAAG,KAAKgC,GAAhB;AACA,UAAM5C,IAAI,GAAG,KAAKA,IAAlB;;AAEA,WAAI,IAAIL,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGQ,MAAM,GAAC,CAA1B,EAA6BR,CAAC,EAA9B,EAAkC;AAChC,aAAI,IAAID,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGQ,KAAK,GAAC,CAAzB,EAA4BR,CAAC,EAA7B,EAAiC;AAC/B,cAAMyE,EAAE,GAAGxD,EAAE,CAACjB,CAAD,EAAIC,CAAJ,CAAF,GAASK,IAApB;AACA,cAAMoE,EAAE,GAAGxD,EAAE,CAAClB,CAAD,EAAIC,CAAJ,CAAF,GAASK,IAApB;AAEAkE,UAAAA,IAAI,CAACxE,CAAD,EAAIC,CAAJ,EAAO,KAAK0E,MAAL,CAAYJ,GAAZ,EAAiBvE,CAAC,GAACyE,EAAnB,EAAuBxE,CAAC,GAACyE,EAAzB,CAAP,CAAJ;AACD;AACF;AACF;;;2BAEME,QAAQ5E,GAAGC,GAAG;AACnB,UAAM4E,EAAE,GAAG,CAAC,CAAC7E,CAAb;AACA,UAAM8E,EAAE,GAAG,CAAC,CAAC7E,CAAb;AACA,UAAM8E,EAAE,GAAGF,EAAE,GAAC,CAAd;AACA,UAAMG,EAAE,GAAGF,EAAE,GAAC,CAAd;AACA,UAAMG,GAAG,GAAGL,MAAM,CAACC,EAAD,EAAKC,EAAL,CAAlB;AACA,UAAMI,GAAG,GAAGN,MAAM,CAACC,EAAD,EAAKG,EAAL,CAAlB;AACA,UAAMG,GAAG,GAAGP,MAAM,CAACG,EAAD,EAAKD,EAAL,CAAlB;AACA,UAAMM,GAAG,GAAGR,MAAM,CAACG,EAAD,EAAKC,EAAL,CAAlB;AAEA,aAAO,iBAAK/E,CAAC,GAAC6E,EAAP,EAAW,iBAAK9E,CAAC,GAAC6E,EAAP,EAAWI,GAAX,EAAgBE,GAAhB,CAAX,EAAiC,iBAAKnF,CAAC,GAAC6E,EAAP,EAAWK,GAAX,EAAgBE,GAAhB,CAAjC,CAAP;AACD;;;wCAEmB;AAClB,UAAM5E,KAAK,GAAG,KAAKA,KAAnB;AACA,UAAMC,MAAM,GAAG,KAAKA,MAApB;AACA,UAAMQ,EAAE,GAAG,KAAKmC,GAAhB;AACA,UAAMlC,EAAE,GAAG,KAAKmC,GAAhB;AACA,UAAMM,GAAG,GAAG,KAAKA,GAAjB;;AAEA,WAAI,IAAI1D,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGQ,MAAM,GAAC,CAA1B,EAA6BR,CAAC,EAA9B,EAAkC;AAChC,aAAI,IAAID,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGQ,KAAK,GAAC,CAAzB,EAA4BR,CAAC,EAA7B,EAAiC;AAC/B;AACA,cAAM6E,EAAE,GAAG5D,EAAE,CAACjB,CAAC,GAAC,CAAH,EAAMC,CAAN,CAAb;AACA,cAAM8E,EAAE,GAAG9D,EAAE,CAACjB,CAAC,GAAC,CAAH,EAAMC,CAAN,CAAb;AACA,cAAM6E,EAAE,GAAG5D,EAAE,CAAClB,CAAD,EAAIC,CAAC,GAAC,CAAN,CAAb;AACA,cAAM+E,EAAE,GAAG9D,EAAE,CAAClB,CAAD,EAAIC,CAAC,GAAC,CAAN,CAAb;AACA0D,UAAAA,GAAG,CAAC3D,CAAD,EAAIC,CAAJ,EAAO,CAAC8E,EAAE,GAAGF,EAAL,GAAUG,EAAV,GAAeF,EAAhB,IAAsB,GAA7B,CAAH;AACD;AACF;AACF;;;+BAEUvB,IAAIE,IAAI1E,GAAGsG,OAAOC,MAAMC,YAAW;AAC5C,UAAM/E,KAAK,GAAG,KAAKA,KAAnB;AACA,UAAMC,MAAM,GAAG,KAAKA,MAApB;AACA8C,MAAAA,EAAE,GAAGA,EAAE,CAACzE,CAAR;AACA2E,MAAAA,EAAE,GAAGA,EAAE,CAAC3E,CAAR;AACAC,MAAAA,CAAC,GAAGA,CAAC,CAACD,CAAN,CAL4C,CAM5C;AACI;AACA;AACJ;;AAEA,WAAI,IAAI8E,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAG2B,UAAnB,EAA+B3B,CAAC,EAAhC,EAAoC;AAClC,aAAI,IAAI3D,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGQ,MAAM,GAAC,CAA1B,EAA6BR,CAAC,EAA9B,EAAkC;AAChC,eAAI,IAAID,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGQ,KAAK,GAAC,CAAzB,EAA4BR,CAAC,EAA7B,EAAiC;AAC/B,gBAAIwF,EAAE,GAAGxF,CAAC,GAACC,CAAC,GAACO,KAAb;AACA,gBAAIqE,EAAE,GAAGtB,EAAE,CAACiC,EAAE,GAAC,CAAJ,CAAX;AACA,gBAAIT,EAAE,GAAGxB,EAAE,CAACiC,EAAE,GAAC,CAAJ,CAAX;AACA,gBAAIV,EAAE,GAAGvB,EAAE,CAACiC,EAAE,GAAChF,KAAJ,CAAX;AACA,gBAAIwE,EAAE,GAAGzB,EAAE,CAACiC,EAAE,GAAChF,KAAJ,CAAX;AAEAiD,YAAAA,EAAE,CAAC+B,EAAD,CAAF,GAAS,CAACX,EAAE,GAAGE,EAAL,GAAUD,EAAV,GAAeE,EAAf,GAAoBK,KAAK,GAAGtG,CAAC,CAACyG,EAAD,CAA9B,IAAsCF,IAA/C;AACD;AACF;;AACD,YAAIlB,GAAG,GAAGb,EAAV;AACAA,QAAAA,EAAE,GAAGE,EAAL;AACAA,QAAAA,EAAE,GAAGW,GAAL,CAdkC,CAelC;AACD;AACF;;;+CAE0B;AACzB,UAAMnD,EAAE,GAAG,KAAKmC,GAAhB;AACA,UAAMlC,EAAE,GAAG,KAAKmC,GAAhB;AACA,UAAMrC,CAAC,GAAG,KAAKuC,EAAf;AACA,UAAM/C,KAAK,GAAG,KAAKA,KAAnB;AACA,UAAMC,MAAM,GAAG,KAAKA,MAApB;;AAEA,WAAI,IAAIR,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGQ,MAAM,GAAC,CAA1B,EAA6BR,CAAC,EAA9B,EAAkC;AAChC,aAAI,IAAID,CAAC,GAAG,CAAZ,EAAeA,CAAC,GAAGQ,KAAK,GAAC,CAAzB,EAA4BR,CAAC,EAA7B,EAAiC;AAC/B,cAAI6E,EAAE,GAAG7D,CAAC,CAAChB,CAAC,GAAC,CAAH,EAAMC,CAAN,CAAV;AACA,cAAI8E,EAAE,GAAG/D,CAAC,CAAChB,CAAC,GAAC,CAAH,EAAMC,CAAN,CAAV;AACA,cAAI6E,EAAE,GAAG9D,CAAC,CAAChB,CAAD,EAAIC,CAAC,GAAC,CAAN,CAAV;AACA,cAAI+E,EAAE,GAAGhE,CAAC,CAAChB,CAAD,EAAIC,CAAC,GAAC,CAAN,CAAV;AACA,cAAIoE,EAAE,GAAG,CAACU,EAAE,GAACF,EAAJ,IAAQ,CAAjB;AACA,cAAIP,EAAE,GAAG,CAACU,EAAE,GAACF,EAAJ,IAAQ,CAAjB;AAEA7D,UAAAA,EAAE,CAACjB,CAAD,EAAIC,CAAJ,EAAOgB,EAAE,CAACjB,CAAD,EAAIC,CAAJ,CAAF,GAASoE,EAAhB,CAAF;AACAnD,UAAAA,EAAE,CAAClB,CAAD,EAAIC,CAAJ,EAAOiB,EAAE,CAAClB,CAAD,EAAIC,CAAJ,CAAF,GAASqE,EAAhB,CAAF;AACD;AACF;AACF;;;2BAEM;AACL,UAAM9D,KAAK,GAAG,KAAKA,KAAnB;AACA,UAAMC,MAAM,GAAG,KAAKA,MAApB;AACA,UAAMgF,IAAI,GAAG,KAAK5C,SAAL,CAAe4C,IAA5B;AACA,UAAMzE,CAAC,GAAG,KAAKuC,EAAf;AACA,UAAMtC,EAAE,GAAG,KAAKgC,GAAhB;AACA,UAAM/B,EAAE,GAAG,KAAKgC,GAAhB;AACA,UAAMnC,WAAW,GAAG,KAAKA,WAAzB;;AAEA,WAAK,IAAId,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGQ,MAApB,EAA4BR,CAAC,EAA7B,EAAiC;AAC/B,aAAK,IAAID,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGQ,KAApB,EAA2BR,CAAC,EAA5B,EAAgC;AAC9B,cAAMF,MAAM,GAAG,CAACG,CAAC,GAAGO,KAAJ,GAAYR,CAAb,IAAkB,CAAjC;;AAD8B,6BAGVe,WAAW,CAACC,CAAC,CAAChB,CAAD,EAAIC,CAAJ,CAAF,EAAUgB,EAAE,CAACjB,CAAD,EAAIC,CAAJ,CAAZ,EAAoBiB,EAAE,CAAClB,CAAD,EAAIC,CAAJ,CAAtB,CAHD;AAAA,cAGtBb,CAHsB,gBAGtBA,CAHsB;AAAA,cAGnBE,CAHmB,gBAGnBA,CAHmB;AAAA,cAGhBP,CAHgB,gBAGhBA,CAHgB;;AAI9B0G,UAAAA,IAAI,CAAC3F,MAAM,GAAG,CAAV,CAAJ,GAAmBpB,IAAI,CAACC,KAAL,CAAWS,CAAX,CAAnB;AACAqG,UAAAA,IAAI,CAAC3F,MAAM,GAAG,CAAV,CAAJ,GAAmBpB,IAAI,CAACC,KAAL,CAAWW,CAAX,CAAnB;AACAmG,UAAAA,IAAI,CAAC3F,MAAM,GAAG,CAAV,CAAJ,GAAmBpB,IAAI,CAACC,KAAL,CAAWI,CAAX,CAAnB,CAN8B,CAO9B;AACD;AACF;;AAED,WAAK2B,GAAL,CAASgF,YAAT,CAAsB,KAAK7C,SAA3B,EAAsC,CAAtC,EAAyC,CAAzC;AACD;;;8BAES;AACR,WAAK8C,QAAL;AACA,WAAKC,IAAL;AAEA3D,MAAAA,MAAM,CAAC4D,qBAAP,CAA6B,KAAKjF,OAAlC;AACD;;;;;;eAGYR;;;;;ACnVf;;AACA;;;;AAGA,IAAM0F,MAAM,GAAG,CACb,SADa,EAEb,SAFa,EAGb,SAHa,EAIb,SAJa,EAKb,SALa,EAMb,SANa,EAOb,SAPa,EAQb,SARa,EASb,SATa,EAUb,SAVa,EAWb,SAXa,EAYb,SAZa,EAab,SAba,EAcb,SAda,EAeb,SAfa,EAgBb,SAhBa,EAiBb,SAjBa,CAAf;AAsBA,IAAMC,OAAO,GAAG,IAAI3F,cAAJ,CAAY4F,QAAQ,CAACC,cAAT,CAAwB,QAAxB,CAAZ,CAAhB;AAEAF,OAAO,CAACG,GAAR;AAEA,IAAIC,aAAa,GAAG,EAApB;;AAEA,SAASC,GAAT,CAAaN,MAAb,EAAqB;AACnB,MAAMO,IAAI,GAAGP,MAAM,CAClBQ,GADY,CACR,gBAIC;AAAA,QAFJC,WAEI,QAFJA,WAEI;AAAA,QADEC,QACF,QADJrF,IACI;AACJ,QAAIA,IAAI,GAAGqF,QAAQ,GAAG,IAAtB;AACArF,IAAAA,IAAI,GAAGA,IAAI,GAAG,CAAP,GAAW,CAAX,GAAgBA,IAAI,GAAG,CAAP,GAAW,CAAX,GAAeA,IAAtC;AACA,QAAIZ,KAAK,GAAG;AACVnB,MAAAA,CAAC,EAAE,iBAAK+B,IAAL,EAAW,GAAX,EAAgBoF,WAAW,CAACnH,CAA5B,CADO;AAEVE,MAAAA,CAAC,EAAE,iBAAK6B,IAAL,EAAW,GAAX,EAAgBoF,WAAW,CAACjH,CAA5B,CAFO;AAGVP,MAAAA,CAAC,EAAE,iBAAKoC,IAAL,EAAW,GAAX,EAAgBoF,WAAW,CAACxH,CAA5B;AAHO,KAAZ;AAMA,WAAO;AACLwB,MAAAA,KAAK,EAALA,KADK;AAELgG,MAAAA,WAAW,EAAXA,WAFK;AAGLpF,MAAAA,IAAI,EAAJA;AAHK,KAAP;AAKD,GAnBY,EAoBZsF,MApBY,CAoBL;AAAA,QAAGtF,IAAH,SAAGA,IAAH;AAAA,WAAcA,IAAI,GAAG,CAArB;AAAA,GApBK,CAAb;AAsBA,SAAOkF,IAAP;AACD;;AAEDK,WAAW,CAAC,YAAM;AAChBP,EAAAA,aAAa,GAAGC,GAAG,CAACD,aAAD,CAAnB,CADgB,CAEhB;;AACA,MAAMQ,MAAM,GAAGC,iBAAiB,CAACT,aAAD,CAAhC;AACAJ,EAAAA,OAAO,CAACc,cAAR,CAAuBF,MAAvB;AACD,CALU,EAKR,GALQ,CAAX;AAOAD,WAAW,CAAC,YAAM;AAChB,MAAMnG,KAAK,GAAG,qBAASuF,MAAM,CAACgB,GAAP,EAAT,CAAd;AACAX,EAAAA,aAAa,CAACY,IAAd,CAAmB;AACjBxG,IAAAA,KAAK,EAAEA,KADU;AAEjBgG,IAAAA,WAAW,EAAEhG,KAFI;AAGjBY,IAAAA,IAAI,EAAE;AAHW,GAAnB;AAKD,CAPU,EAOR,IAPQ,CAAX;;AASA,SAASyF,iBAAT,CAA2Bd,MAA3B,EAAmC;AACjC,SAAO,UAAC9E,CAAD,EAAIC,EAAJ,EAAQC,EAAR,EAAe;AACpB,QAAMC,IAAI,GAAGH,CAAC,GAAG,GAAJ,GAAU,GAAvB;AAEA,WAAOgG,kBAAkB,CAAClB,MAAD,EAAS3E,IAAT,CAAzB;AACD,GAJD;AAKD;;AAGD,SAAS6F,kBAAT,CAA4BlB,MAA5B,EAAoCmB,KAApC,EAA2C;AACzC,MAAM9F,IAAI,GAAG8F,KAAK,GAAG,CAAR,GAAY,CAAZ,GAAiBA,KAAK,GAAG,CAAR,GAAY,CAAZ,GAAgBA,KAA9C;AACA,MAAIC,QAAJ;;AACA,MAAIpB,MAAM,CAACjC,MAAP,GAAgB,CAApB,EAAuB;AACrB,QAAMsD,YAAY,GAAGrB,MAAM,CAACsB,MAAP,CAAc,UAACpG,CAAD,EAAInC,CAAJ,EAAU;AAC3C,aAAOmC,CAAC,CAACG,IAAF,IAAUtC,CAAC,CAACsC,IAAZ,GAAmBtC,CAAnB,GAAuBmC,CAA9B;AACD,KAFoB,CAArB;AAGAkG,IAAAA,QAAQ,GAAG;AACT3G,MAAAA,KAAK,EAAE4G,YAAY,CAACZ,WADX;AAETpF,MAAAA,IAAI,EAAE;AAFG,KAAX;AAID,GARD,MAQO;AACL+F,IAAAA,QAAQ,GAAG;AACT3G,MAAAA,KAAK,EAAE;AACLnB,QAAAA,CAAC,EAAE,GADE;AAELE,QAAAA,CAAC,EAAE,GAFE;AAGLP,QAAAA,CAAC,EAAE;AAHE,OADE;AAMToC,MAAAA,IAAI,EAAE;AANG,KAAX;AAQD;;AApBwC,uBAyBrC2E,MAAM,CAACsB,MAAP,CAAc,UAACpG,CAAD,EAAInC,CAAJ,EAAU;AAC1B,QAAImC,CAAC,CAACqG,KAAF,CAAQlG,IAAR,IAAgBtC,CAAC,CAACsC,IAAlB,IAA0BtC,CAAC,CAACsC,IAAF,GAASA,IAAvC,EAA6C;AAC3C,aAAO;AACLkG,QAAAA,KAAK,EAAExI,CADF;AAELyI,QAAAA,GAAG,EAAEtG,CAAC,CAACsG;AAFF,OAAP;AAID;;AAED,QAAItG,CAAC,CAACsG,GAAF,CAAMnG,IAAN,IAActC,CAAC,CAACsC,IAAhB,IAAwBtC,CAAC,CAACsC,IAAF,IAAUA,IAAtC,EAA4C;AAC1C,aAAO;AACLkG,QAAAA,KAAK,EAAErG,CAAC,CAACqG,KADJ;AAELC,QAAAA,GAAG,EAAEzI;AAFA,OAAP;AAID;;AAED,WAAOmC,CAAP;AACD,GAhBG,EAgBD;AACDqG,IAAAA,KAAK,EAAE;AACL9G,MAAAA,KAAK,EAAE;AACLnB,QAAAA,CAAC,EAAE,GADE;AAELE,QAAAA,CAAC,EAAE,GAFE;AAGLP,QAAAA,CAAC,EAAE;AAHE,OADF;AAMLoC,MAAAA,IAAI,EAAE;AAND,KADN;AASDmG,IAAAA,GAAG,EAAEJ;AATJ,GAhBC,CAzBqC;AAAA,MAuBvCG,KAvBuC,kBAuBvCA,KAvBuC;AAAA,MAwBvCC,GAxBuC,kBAwBvCA,GAxBuC;;AAqDzC,MAAMC,KAAK,GAAG,CAACpG,IAAI,GAAGkG,KAAK,CAAClG,IAAd,KAAuBmG,GAAG,CAACnG,IAAJ,GAAWkG,KAAK,CAAClG,IAAxC,CAAd;AAEA,MAAMZ,KAAK,GAAG;AACZnB,IAAAA,CAAC,EAAE,iBAAKmI,KAAL,EAAYF,KAAK,CAAC9G,KAAN,CAAYnB,CAAxB,EAA2BkI,GAAG,CAAC/G,KAAJ,CAAUnB,CAArC,CADS;AAEZE,IAAAA,CAAC,EAAE,iBAAKiI,KAAL,EAAYF,KAAK,CAAC9G,KAAN,CAAYjB,CAAxB,EAA2BgI,GAAG,CAAC/G,KAAJ,CAAUjB,CAArC,CAFS;AAGZP,IAAAA,CAAC,EAAE,iBAAKwI,KAAL,EAAYF,KAAK,CAAC9G,KAAN,CAAYxB,CAAxB,EAA2BuI,GAAG,CAAC/G,KAAJ,CAAUxB,CAArC;AAHS,GAAd;;AAMA,MAAIyI,KAAK,CAACjH,KAAK,CAACnB,CAAP,CAAT,EAAoB;AAClBqI,IAAAA,OAAO,CAACC,GAAR,CAAYnH,KAAZ,EAAmB8G,KAAnB,EAA0BC,GAA1B,EAA+BnG,IAA/B;AACA,UAAM,IAAIwG,KAAJ,CAAU,KAAV,CAAN;AACD;;AAED,SAAOpH,KAAP;AACD","file":"main.1f19ae8e.map","sourceRoot":"../src","sourcesContent":["export function random(n) {\n  return Math.floor(Math.random() * n)\n}\n\nexport function lerp(c, a, b){\n  c = c < 0 ? 0 : (c > 1 ? 1 : c);\n\n  return a * (1 - c) + b * c;\n}\n\nexport function hexToRgb(hex) {\n  var result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex);\n  return result ? {\n      r: parseInt(result[1], 16),\n      g: parseInt(result[2], 16),\n      b: parseInt(result[3], 16),\n  } : null;\n}\n\nexport function clamp(a, min, max){\n  return Math.max(Math.min(a, max), min);\n}\n","import { lerp, clamp, hexToRgb, random } from './utils'\n\nfunction sampler(a, width, height, stride, offset){\n  var f = function(x, y, value) {\n      x = (x < 0 ? 0 : (x > width-1 ? width-1 : x))|0;\n      y = (y < 0 ? 0 : (y > height-1 ? height-1 : y))|0;\n      if(value !== undefined){\n          a[(x+y*width)*stride+offset] = value;\n      }\n      else {\n          return a[(x+y*width)*stride+offset];\n      }\n  };\n  f.a = a;\n  return f;\n}\n\nclass Fluider {\n  constructor(canvas, {\n    step = 4.0,\n    color = '#ff3000',\n  } = {}) {\n    this.canvas = canvas;\n    this.WIDTH = canvas.width;\n    this.HEIGHT = canvas.height;\n    this.ctx = canvas.getContext('2d');\n    \n    this.step = step;\n    this.color = color;\n\n    this.animate = this.animate.bind(this);\n    this.setColor = this.setColor.bind(this);\n    this.colorMapper = (p, ux, uy) => {\n      \n      const rate = p * 555 / 255;\n      const srcColor = hexToRgb('#FFFFFF')\n      const destColor = hexToRgb('#fca649')\n      return {\n        r: lerp(rate, srcColor.r, destColor.r),\n        g: lerp(rate, srcColor.g, destColor.g),\n        b: lerp(rate, srcColor.b, destColor.b),\n      }\n      \n    }\n  }\n\n  setColor(color) {\n    this.color = hexToRgb(color) || hexToRgb('#ff3000');\n  }\n\n  setColorMapper(func) {\n    this.colorMapper = func;\n  }\n\n  run() {\n    this.setColor(this.color);\n\n    this.sx = this.canvas.width/ this.canvas.clientWidth;\n    this.sy = this.canvas.height/ this.canvas.clientHeight;\n    this.mouseX = 0;\n    this.mouseY = 0;\n    const rect = this.canvas.getBoundingClientRect();\n    this.left = rect.left\n    this.top = rect.top;\n\n    window.addEventListener('mousemove', (e) => {\n        this.mouseX = (e.clientX - this.left)|0,\n        this.mouseY = (e.clientY - this.top)|0;\n    }); \n\n    this.lastMouseX = this.mouseX;\n    this.lastMouseY = this.mouseY;\n\n\n    // \n    this.pointX = 100;\n    this.pointY = 100;\n    this.prevPointX = this.pointX;\n    this.prevPointY = this.pointY;\n\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n\n    this.ctx.fillRect(0, 0, WIDTH, HEIGHT);\n    this.imageData = this.ctx.getImageData(0, 0, WIDTH, HEIGHT);\n\n    this.velocityField0 = new Float32Array(WIDTH*HEIGHT*2);\n    this.u0x = sampler(this.velocityField0, WIDTH, HEIGHT, 2, 0);\n    this.u0y = sampler(this.velocityField0, WIDTH, HEIGHT, 2, 1);\n    this.velocityField1 = new Float32Array(WIDTH*HEIGHT*2);\n    this.u1x = sampler(this.velocityField1, WIDTH, HEIGHT, 2, 0);\n    this.u1y = sampler(this.velocityField1, WIDTH, HEIGHT, 2, 1);\n    this.pressureField0 = new Float32Array(WIDTH*HEIGHT);\n    this.p0 = sampler(this.pressureField0, WIDTH, HEIGHT, 1, 0);\n    this.pressureField1 = new Float32Array(WIDTH*HEIGHT);\n    this.p1 = sampler(this.pressureField1, WIDTH, HEIGHT, 1, 0);\n    this.divergenceField = new Float32Array(WIDTH*HEIGHT);\n    this.div = sampler(this.divergenceField, WIDTH, HEIGHT, 1, 0);\n\n    for(let i = 0; i < this.pressureField0.length; i++) {\n      this.pressureField0[i] = 0;\n      this.pressureField1[i] = this.pressureField0[i];\n    }\n\n    for(let i = 0; i < this.velocityField0.length; i++) {\n      this.velocityField1[i] = this.velocityField0[i];\n    }\n\n    this.velocityBoundary();\n\n    this.animate();\n    // setInterval(() => {\n    //   this.move(this.pointX - 10 + random(20), this.pointX - 10 + random(20));\n    // }, 100)\n  }\n\n  simulate() {\n    this.velocityBoundary();\n    this.advect(this.u0x, this.u1x);\n    this.advect(this.u0y, this.u1y);\n    this.addMouseForce();\n    // this.move(this.pointX - 1 + random(3), this.pointY - 1 + random(3))\n    // this.addPoint();\n    this.computeDivergence();\n    this.fastjacobi(this.p0, this.p1, this.div, -1, 0.25, 10);\n    this.subtractPressureGradient();\n\n    let aux = this.p0;\n    this.p0 = this.p1;\n    this.p1 = aux;\n  \n    aux = this.u0x;\n    this.u0x = this.u1x;\n    this.u1x = aux;\n  \n    aux = this.u0y;\n    this.u0y = this.u1y;\n    this.u1y = aux;\n  }\n\n  move(x, y) {\n    this.pointX = x;\n    this.pointY = y;\n  }\n\n  addPoint() {\n    const ux = this.u1x;\n    const uy = this.u1y;\n\n    const x = clamp(this.pointX, 10, this.WIDTH - 11);\n    const y = clamp(this.pointY, 10, this.HEIGHT - 11);\n\n    const dx = this.pointX - this.prevPointX;\n    const dy = this.pointY - this.prevPointY;\n\n    this.prevPointX = this.pointX;\n    this.prevPointY = this.pointX;\n\n    ux(x, y, ux(x, y)-dx);\n    uy(x, y, uy(x, y)-dy);\n  }\n\n  addMouseForce() {\n    const ux = this.u1x;\n    const uy = this.u1y;\n\n    const x = clamp(this.mouseX * this.sx, 1, this.WIDTH - 2);\n    const y = clamp(this.mouseY * this.sy, 1, this.HEIGHT - 2);\n\n    // console.log(x, y);\n    const dx = this.mouseX - this.lastMouseX;\n    const dy = this.mouseY - this.lastMouseY;\n\n    // console.log(dx, dy);\n    this.lastMouseX = this.mouseX;\n    this.lastMouseY = this.mouseY;\n\n    \n    ux(x, y, ux(x, y)-dx);\n    uy(x, y, uy(x, y)-dy);\n  }\n\n  velocityBoundary() {\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n\n    const ux = this.u0x;\n    const uy = this.u0y;\n\n    for(let x = 0; x < WIDTH; x++) {\n      ux(x, 0, -ux(x, 1));\n      uy(x, 0, -uy(x, 1));\n\n      ux(x, HEIGHT-1, -ux(x, HEIGHT-2));\n      uy(x, HEIGHT-1, -uy(x, HEIGHT-2));\n    }\n\n    for(let y = 0; y < HEIGHT; y++) {\n      ux(0, y, -ux(1, y));\n      uy(0, y, -uy(1, y));\n\n      ux(WIDTH-1, y, -ux(WIDTH-2, y));\n      uy(WIDTH-1, y, -uy(WIDTH-2, y));\n    }\n  }\n\n  advect(src, dest) {\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n    const ux = this.u0x;\n    const uy = this.u0y;\n    const step = this.step;\n\n    for(let y = 1; y < HEIGHT-1; y++) {\n      for(let x = 1; x < WIDTH-1; x++) {\n        const vx = ux(x, y)*step;\n        const vy = uy(x, y)*step;\n  \n        dest(x, y, this.bilerp(src, x+vx, y+vy));\n      }\n    }\n  }\n\n  bilerp(sample, x, y) {\n    const x0 = ~~x;\n    const y0 = ~~y;\n    const x1 = x0+1;\n    const y1 = y0+1;\n    const p00 = sample(x0, y0);\n    const p01 = sample(x0, y1);\n    const p10 = sample(x1, y0);\n    const p11 = sample(x1, y1);\n\n    return lerp(y-y0, lerp(x-x0, p00, p10), lerp(x-x0, p01, p11));\n  }\n\n  computeDivergence() {\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n    const ux = this.u1x;\n    const uy = this.u1y;\n    const div = this.div;\n\n    for(let y = 1; y < HEIGHT-1; y++) {\n      for(let x = 1; x < WIDTH-1; x++) {\n        // compute divergence using central difference\n        const x0 = ux(x-1, y);\n        const x1 = ux(x+1, y);\n        const y0 = uy(x, y-1);\n        const y1 = uy(x, y+1);\n        div(x, y, (x1 - x0 + y1 - y0) * 0.5);\n      }\n    }\n  }\n\n  fastjacobi(p0, p1, b, alpha, beta, iterations){\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n    p0 = p0.a;\n    p1 = p1.a;\n    b = b.a;\n    //for(var i = 0; i < pressureField0.length; i++) {\n        //pressureField0[i] = 0.5;\n        //pressureField1[i] = pressureField0[i];\n    //}\n\n    for(let i = 0; i < iterations; i++) {\n      for(let y = 1; y < HEIGHT-1; y++) {\n        for(let x = 1; x < WIDTH-1; x++) {\n          let pi = x+y*WIDTH;\n          let x0 = p0[pi-1];\n          let x1 = p0[pi+1];\n          let y0 = p0[pi-WIDTH];\n          let y1 = p0[pi+WIDTH];\n\n          p1[pi] = (x0 + x1 + y0 + y1 + alpha * b[pi]) * beta;\n        }\n      }\n      var aux = p0;\n      p0 = p1;\n      p1 = aux;\n      //pressureboundary(p0);\n    }\n  }\n\n  subtractPressureGradient() {\n    const ux = this.u1x;\n    const uy = this.u1y;\n    const p = this.p0;\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n\n    for(var y = 1; y < HEIGHT-1; y++) {\n      for(var x = 1; x < WIDTH-1; x++) {\n        let x0 = p(x-1, y);\n        let x1 = p(x+1, y);\n        let y0 = p(x, y-1);\n        let y1 = p(x, y+1);\n        let dx = (x1-x0)/2;\n        let dy = (y1-y0)/2;\n\n        ux(x, y, ux(x, y)-dx);\n        uy(x, y, uy(x, y)-dy);\n      }\n    }\n  }\n\n  draw() {\n    const WIDTH = this.WIDTH;\n    const HEIGHT = this.HEIGHT;\n    const data = this.imageData.data;\n    const p = this.p0;\n    const ux = this.u0x;\n    const uy = this.u0y;\n    const colorMapper = this.colorMapper;\n\n    for (let y = 0; y < HEIGHT; y++) {\n      for (let x = 0; x < WIDTH; x++) {\n        const offset = (y * WIDTH + x) * 4;\n\n        const { r, g, b } = colorMapper(p(x, y), ux(x, y), uy(x, y))\n        data[offset + 0] = Math.floor(r);\n        data[offset + 1] = Math.floor(g);\n        data[offset + 2] = Math.floor(b);\n        // data[offset + 3] = 255;\n      }\n    }\n\n    this.ctx.putImageData(this.imageData, 0, 0);\n  }\n\n  animate() {\n    this.simulate();\n    this.draw();\n\n    window.requestAnimationFrame(this.animate);\n  }\n}\n\nexport default Fluider","import Fluider from './fluid'\nimport { random, hexToRgb, lerp } from './utils'\n\n\nconst colors = [\n  '#ff3000',\n  '#e2234c',\n  '#fca649',\n  '#fcd532',\n  '#c1ff4a',\n  '#03e574',\n  '#82f975',\n  '#f7883c',\n  '#f95023',\n  '#22cefc',\n  '#06eaea',\n  '#35d2fc',\n  '#b688ff',\n  '#f97dc1',\n  '#fcb1e1',\n  '#efb7f7',\n  '#fcc0d0',\n]\n\n\n\nconst fluider = new Fluider(document.getElementById('canvas'));\n\nfluider.run();\n\nlet currentColors = []\n\nfunction age(colors) {\n  const aged = colors\n  .map(({\n    // color: prevColor,\n    originColor,\n    rate: prevRate,\n  }) => {\n    let rate = prevRate - 0.01;\n    rate = rate < 0 ? 0 : (rate > 1 ? 1 : rate);\n    let color = {\n      r: lerp(rate, 255, originColor.r),\n      g: lerp(rate, 255, originColor.g),\n      b: lerp(rate, 255, originColor.b),\n    }\n    \n    return {\n      color,\n      originColor,\n      rate,\n    }\n  })\n  .filter(({ rate }) => rate > 0)\n\n  return aged;\n}\n\nsetInterval(() => {\n  currentColors = age(currentColors)\n  // console.log(currentColors)\n  const mapper = createColorMapper(currentColors)\n  fluider.setColorMapper(mapper)\n}, 100)\n\nsetInterval(() => {\n  const color = hexToRgb(colors.pop())\n  currentColors.push({\n    color: color,\n    originColor: color,\n    rate: 1, \n  })\n}, 2000)\n\nfunction createColorMapper(colors) {\n  return (p, ux, uy) => {\n    const rate = p * 555 / 255;\n\n    return getGradientedColor(colors, rate)\n  }\n}\n\n\nfunction getGradientedColor(colors, _rate) {\n  const rate = _rate > 1 ? 1 : (_rate < 0 ? 0 : _rate);\n  let bigColor;\n  if (colors.length > 1) {\n    const biggestColor = colors.reduce((p, c) => {\n      return p.rate <= c.rate ? c : p\n    })\n    bigColor = {\n      color: biggestColor.originColor,\n      rate: 1,\n    }\n  } else {\n    bigColor = {\n      color: {\n        r: 255,\n        g: 255,\n        b: 255,\n      },\n      rate: 1,\n    }\n  }\n\n  const { \n    small,\n    big,\n  } = colors.reduce((p, c) => {\n    if (p.small.rate <= c.rate && c.rate < rate) {\n      return {\n        small: c,\n        big: p.big,\n      }\n    } \n\n    if (p.big.rate >= c.rate && c.rate >= rate) {\n      return {\n        small: p.small,\n        big: c,\n      }\n    }\n\n    return p\n  }, {\n    small: {\n      color: {\n        r: 255,\n        g: 255,\n        b: 255,\n      },\n      rate: 0,\n    },\n    big: bigColor\n  })\n\n  const ratio = (rate - small.rate) / (big.rate - small.rate);\n\n  const color = {\n    r: lerp(ratio, small.color.r, big.color.r),\n    g: lerp(ratio, small.color.g, big.color.g),\n    b: lerp(ratio, small.color.b, big.color.b),\n  }\n\n  if (isNaN(color.r)) {\n    console.log(color, small, big, rate)\n    throw new Error('NaN')\n  }\n\n  return color;\n}\n\n\n"]}