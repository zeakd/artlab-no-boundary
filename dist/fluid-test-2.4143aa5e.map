{"version":3,"sources":["fluid-test-2.js"],"names":["canvas","document","getElementById","WIDTH","width","HEIGHT","height","sx","clientWidth","sy","clientHeight","ctx","getContext","mouseX","mouseY","rect","getBoundingClientRect","left","top","addEventListener","e","clientX","clientY","fillRect","imageData","getImageData","velocityField0","Float32Array","u0x","sampler","u0y","velocityField1","u1x","u1y","pressureField0","p0","pressureField1","p1","divergenceField","div","step","i","length","velocityboundary","simulate","advect","addMouseForce","computeDivergence","fastjacobi","subtractPressureGradient","aux","lastMouseX","lastMouseY","ux","uy","x","clamp","y","dx","dy","pressureboundary","p","a","min","max","Math","lerp","b","c","stride","offset","f","value","undefined","bilerp","sample","x0","y0","x1","y1","p00","p01","p10","p11","src","dest","t","vx","vy","jacobi","alpha","beta","iterations","pi","draw","d","data","di","ui","putImageData","requestAnimationFrame","window","animate"],"mappings":"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","file":"fluid-test-2.4143aa5e.map","sourceRoot":"../src","sourcesContent":["(function(){\n    \n  var canvas = document.getElementById('c'),\n      WIDTH = canvas.width,\n      HEIGHT = canvas.height,\n      sx = canvas.width/canvas.clientWidth,\n      sy = canvas.height/canvas.clientHeight,\n      ctx = canvas.getContext('2d');\n  \n  var mouseX = 0, mouseY = 0;\n  (function(){\n  var rect = canvas.getBoundingClientRect(),\n      left = rect.left,\n      top = rect.top;\n  canvas.addEventListener('mousemove', function(e) {\n      mouseX = (e.clientX - left)|0,\n      mouseY = (e.clientY - top)|0;\n  }); \n  })();\n  \n//   setInterval(() => {\n//     mouseX = 50 + Math.floor(Math.random() * 200)\n//     mouseY = 50 + Math.floor(Math.random() * 200)\n//   }, 100)\n  \n  \n  ctx.fillRect(0, 0, WIDTH, HEIGHT);\n  \n  var imageData = ctx.getImageData(0, 0, WIDTH, HEIGHT);\n      velocityField0 = new Float32Array(WIDTH*HEIGHT*2),\n      u0x = sampler(velocityField0, WIDTH, HEIGHT, 2, 0),\n      u0y = sampler(velocityField0, WIDTH, HEIGHT, 2, 1),\n      velocityField1 = new Float32Array(WIDTH*HEIGHT*2),\n      u1x = sampler(velocityField1, WIDTH, HEIGHT, 2, 0),\n      u1y = sampler(velocityField1, WIDTH, HEIGHT, 2, 1),\n      pressureField0 = new Float32Array(WIDTH*HEIGHT),\n      p0 = sampler(pressureField0, WIDTH, HEIGHT, 1, 0),\n      pressureField1 = new Float32Array(WIDTH*HEIGHT),\n      p1 = sampler(pressureField1, WIDTH, HEIGHT, 1, 0),\n      divergenceField = new Float32Array(WIDTH*HEIGHT),\n      div = sampler(divergenceField, WIDTH, HEIGHT, 1, 0),\n          step = 4.0;\n  \n  for(var i = 0; i < pressureField0.length; i++) {\n      pressureField0[i] = 0;\n      pressureField1[i] = pressureField0[i];\n  }\n  for(i = 0; i < velocityField0.length; i++) {\n      //velocityField0[i] = (Math.random()-0.5)*10.0;\n      velocityField1[i] = velocityField0[i];\n  }\n  velocityboundary(u0x, u0y);\n  \n  \n  function simulate(){\n      velocityboundary(u0x, u0y);\n      advect(u0x, u0y, u0x, u1x, step);\n      advect(u0x, u0y, u0y, u1y, step);\n      addMouseForce(u1x, u1y);\n      computeDivergence(u1x, u1y, div);\n      // needs an even number of iterations\n      fastjacobi(p0, p1, div, -1, 0.25, 20);\n      //advect(u1x, u1y, p0, p1);\n      //velocityField0 = diffuse(velocityField1, pressureField);\n      //pressureField = recomputePressure(velocityField0);\n      subtractPressureGradient(u1x, u1y, p0);\n      var aux = p0;\n      p0 = p1;\n      p1 = aux;\n  \n      aux = u0x;\n      u0x = u1x;\n      u1x = aux;\n  \n      aux = u0y;\n      u0y = u1y;\n      u1y = aux;\n  }\n  var lastMouseX = mouseX,\n      lastMouseY = mouseY;\n  \n  function addMouseForce(ux, uy){\n      var x = clamp(mouseX*sx, 1, WIDTH-2),\n          y = clamp(mouseY*sy, 1, HEIGHT-2),\n          dx = mouseX-lastMouseX,\n          dy = mouseY-lastMouseY;\n      lastMouseX = mouseX;\n      lastMouseY = mouseY;\n      ux(x, y, ux(x, y)-dx*2);\n      uy(x, y, uy(x, y)-dy*2);\n  }\n  \n  function pressureboundary(p){\n      for(var x = 0; x < WIDTH; x++) {\n          p(x, 0, p(x, 1));\n          p(x, HEIGHT-1, p(x, HEIGHT-2));\n      }\n      for(var y = 0; y < HEIGHT; y++) {\n          p(0, y, p(1, y));\n          p(WIDTH-1, y, p(WIDTH-2, y));\n      }\n  }\n  \n  function velocityboundary(ux, uy){\n      for(var x = 0; x < WIDTH; x++) {\n          ux(x, 0, -ux(x, 1));\n          uy(x, 0, -uy(x, 1));\n  \n          ux(x, HEIGHT-1, -ux(x, HEIGHT-2));\n          uy(x, HEIGHT-1, -uy(x, HEIGHT-2));\n      }\n      for(var y = 0; y < HEIGHT; y++) {\n          ux(0, y, -ux(1, y));\n          uy(0, y, -uy(1, y));\n  \n          ux(WIDTH-1, y, -ux(WIDTH-2, y));\n          uy(WIDTH-1, y, -uy(WIDTH-2, y));\n      }\n  }\n  \n  function clamp(a, min, max){\n      return Math.max(Math.min(a, max), min);\n  \n  }\n  \n  function lerp(a, b, c){\n      c = c < 0 ? 0 : (c > 1 ? 1 : c);\n      //c = clamp(c, 0, 1);\n      return a * (1 - c) + b * c;\n  }\n  \n  function sampler(a, width, height, stride, offset){\n      var f = function(x, y, value) {\n          x = (x < 0 ? 0 : (x > width-1 ? width-1 : x))|0;\n          y = (y < 0 ? 0 : (y > height-1 ? height-1 : y))|0;\n          if(value !== undefined){\n              a[(x+y*width)*stride+offset] = value;\n          }\n          else {\n              return a[(x+y*width)*stride+offset];\n          }\n      };\n      f.a = a;\n      return f;\n  }\n  \n  function bilerp(sample, x, y) {\n      var x0 = ~~x,\n          y0 = ~~y,\n          x1 = x0+1,\n          y1 = y0+1,\n          p00 = sample(x0, y0),\n          p01 = sample(x0, y1),\n          p10 = sample(x1, y0),\n          p11 = sample(x1, y1);\n      return lerp(lerp(p00, p10, x-x0), lerp(p01, p11, x-x0), y-y0);\n  }\n  \n  \n  function advect(ux, uy, src, dest, t){\n      for(var y = 1; y < HEIGHT-1; y++) {\n          for(var x = 1; x < WIDTH-1; x++) {\n              var vx = ux(x, y)*t,\n                  vy = uy(x, y)*t;\n              dest(x, y, bilerp(src, x+vx, y+vy));\n          }\n      }\n  }\n  \n  function computeDivergence(ux, uy, div){\n      for(var y = 1; y < HEIGHT-1; y++) {\n          for(var x = 1; x < WIDTH-1; x++) {\n              // compute divergence using central difference\n              var x0 = ux(x-1, y),\n                  x1 = ux(x+1, y),\n                  y0 = uy(x, y-1),\n                  y1 = uy(x, y+1);\n              div(x, y, (x1-x0 + y1-y0)*0.5);\n          }\n      }\n  }\n  // x = p\n  // b = div\n  function jacobi(p0, p1, b, alpha, beta, iterations){\n      for(var i = 0; i < pressureField0.length; i++) {\n          pressureField0[i] = 0.5;\n          pressureField1[i] = pressureField0[i];\n      }\n  \n      for(i = 0; i < iterations; i++) {\n          for(var y = 1; y < HEIGHT-1; y++) {\n              for(var x = 1; x < WIDTH-1; x++) {\n                  var x0 = p0(x-1, y),\n                      x1 = p0(x+1, y),\n                      y0 = p0(x, y-1),\n                      y1 = p0(x, y+1);\n                  p1(x, y, (x0 + x1 + y0 + y1 + alpha * b(x, y)) * beta);\n              }\n          }\n          var aux = p0;\n          p0 = p1;\n          p1 = aux;\n          pressureboundary(p0);\n      }\n  }\n  \n  function fastjacobi(p0, p1, b, alpha, beta, iterations){\n      p0 = p0.a;\n      p1 = p1.a;\n      b = b.a;\n      //for(var i = 0; i < pressureField0.length; i++) {\n          //pressureField0[i] = 0.5;\n          //pressureField1[i] = pressureField0[i];\n      //}\n  \n      for(i = 0; i < iterations; i++) {\n          for(var y = 1; y < HEIGHT-1; y++) {\n              for(var x = 1; x < WIDTH-1; x++) {\n                  var pi = x+y*WIDTH,\n                      x0 = p0[pi-1],\n                      x1 = p0[pi+1],\n                      y0 = p0[pi-WIDTH],\n                      y1 = p0[pi+WIDTH];\n                  p1[pi] = (x0 + x1 + y0 + y1 + alpha * b[pi]) * beta;\n              }\n          }\n          var aux = p0;\n          p0 = p1;\n          p1 = aux;\n          //pressureboundary(p0);\n      }\n  }\n  \n  function subtractPressureGradient(ux, uy, p){\n      for(var y = 1; y < HEIGHT-1; y++) {\n          for(var x = 1; x < WIDTH-1; x++) {\n              var x0 = p(x-1, y),\n                  x1 = p(x+1, y),\n                  y0 = p(x, y-1),\n                  y1 = p(x, y+1),\n                  dx = (x1-x0)/2,\n                  dy = (y1-y0)/2;\n                  ux(x, y, ux(x, y)-dx);\n                  uy(x, y, uy(x, y)-dy);\n          }\n      }\n  }\n  \n  function draw(ux, uy, p){\n      var d = imageData.data,\n          di, pi, ui;\n      for(var y = 0; y < HEIGHT; y++) {\n          for(var x = 0; x < WIDTH; x++) {\n              pi = (y*WIDTH+x);\n              ui = pi*2;\n              di = pi*4;\n              d[di+0] = p(x, y)*555;\n              d[di+1] = ux(x, y)*128+128;\n              d[di+2] = uy(x, y)*128+128;\n          }\n      }\n      ctx.putImageData(imageData, 0, 0);\n  }\n  \n  \n  var requestAnimationFrame = window.requestAnimationFrame;\n\n  \n  (function animate(){\n      simulate();\n      draw(u0x, u0y, p0);\n      requestAnimationFrame(animate);\n  })();\n  \n  \n  \n  })();\n  "]}